<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opiyo Okach</title>

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="overlay" class="container-fluid">
      <div class="row">
          <div class="col-12 d-flex align-items-center justify-content-center">
              <div>
                  <h1>Opiyo Okach Project</h1>
                  <h4>Instructions for computer</h4>
                  <p>Use your mouse to engage with the project</p>
                  <ul>
                      <li>click and drag with the mouse to orbit around the network</li>
                      <li>zoom in and out to move</li>
                      <li>click on the words to open the different chapters of the project</li>
                  </ul>
                  <h4>Instructions for touch screen</h4>
                  <ul>
                      <li>tag and drag to orbit around the network</li>
                      <li>pinch to zoom in and out</li>
                      <li>tap on words to open different chapters of the project</li>
                  </ul>
              </div>
          </div>
          <div class="col-12 text-center my-5">
              <button id="startButton" class="btn btn-light btn-lg">Play</button>
          </div>
      </div>
  </div>

    <div class="three-js-container">
      <canvas id="c"></canvas>
        <div class="labels">
        </div>
    </div>
    

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <!-- <script src="globals.js"></script> -->

    <script type="module">

import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/build/three.module.js';
import {OrbitControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/examples/jsm/controls/OrbitControls.js';
// import {GUI} from 'https://threejsfundamentals.org/threejs/../3rdparty/dat.gui.module.js';

console.log('particles step 2');

function main() {

  // camera and canvas
  const canvas = document.querySelector('#c');
  const renderer = new THREE.WebGLRenderer({canvas});

  const fov = 45;
  const aspect = 2;  // the canvas default
  const near = 0.1;
  const far = 100;
  const camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 10000 );
  camera.position.set( 0, 25, 200 );

  // update camera
  function updateCamera() {
    camera.updateProjectionMatrix();
  }

  // orbit controls
  const controls = new OrbitControls(camera, canvas);
  controls.target.set(0, 5, 0);
  controls.update();

  // new scene
  const scene = new THREE.Scene();
  scene.background = new THREE.Color('black');
  scene.fog = new THREE.FogExp2( 0x000000, 0.0025 );

  // add light
  {
    const color = 0xFFFFFF;
    const intensity = 1;
    const light = new THREE.DirectionalLight(color, intensity);
    light.position.set(0, 0.5, 1);
    light.target.position.set(0, 0, 0);
    scene.add(light);
    scene.add(light.target);
  }

// bring in audio
  const audioElems = () => {
    // bring in audio listener
      const listener = new THREE.AudioListener();
      camera.add( listener );

      // sound spheres
      const square = new THREE.BoxGeometry(30, 30, 30);

      const material1 = new THREE.MeshBasicMaterial( { color: 0xffaa00 } );
      const material2 = new THREE.MeshBasicMaterial( { color: 0xff2200 } );
      const material3 = new THREE.MeshBasicMaterial( { color: 0x6622aa } );

      // sound spheres

      const audioLoader = new THREE.AudioLoader();

      const mesh1 = new THREE.Mesh( square, material1 );
      mesh1.position.set( - 250, 30, 0 );
      scene.add( mesh1 );

      const sound1 = new THREE.PositionalAudio( listener );
      audioLoader.load( 'assets/bensound-anewbeginning.ogg', function ( buffer ) {

        sound1.setLoop()
        sound1.setBuffer( buffer );
        sound1.setRefDistance( 20 );
        sound1.play();

      } );
      mesh1.add( sound1 );

      //

      const mesh2 = new THREE.Mesh( square, material2 );
      mesh2.position.set( 250, 30, 0 );
      scene.add( mesh2 );

      const sound2 = new THREE.PositionalAudio( listener );
      audioLoader.load( 'assets/bensound-creativeminds.ogg', function ( buffer ) {

        sound2.setLoop()
        sound2.setBuffer( buffer );
        sound2.setRefDistance( 20 );
        sound2.play();

      } );
      mesh2.add( sound2 );

      //

      const mesh3 = new THREE.Mesh( square, material3 );
      mesh3.position.set(  0, 30, - 250 );
      scene.add( mesh3 );

      const sound3 = new THREE.PositionalAudio( listener );
      audioLoader.load( 'assets/bensound-ukulele.ogg', function ( buffer ) {

        sound3.setLoop();
        sound3.setBuffer( buffer );
        sound3.setRefDistance( 20 );
        sound3.play();

      } );
      mesh3.add( sound3 );  

      // analysers

      const analyser1 = new THREE.AudioAnalyser( sound1, 32 );
      const analyser2 = new THREE.AudioAnalyser( sound2, 32 );
      const analyser3 = new THREE.AudioAnalyser( sound3, 32 );

}
  
  audioElems();




  let particlesData = [];
  let positions, colors;
  let particles;
  let pointCloud;
  let particlePositions;
  let linesMesh;

  const maxParticleCount = 100;
  const particleCount = 50;
  const r = 200;
  const rHalf = r / 2;

  const cloudGroup = new THREE.Group();
  scene.add( cloudGroup );

  const segments = maxParticleCount * maxParticleCount;

  positions = new Float32Array( segments * 3 );
  colors = new Float32Array( segments * 3 );

  var pMaterial = new THREE.PointsMaterial( {
      color: 0xFFFFFF,
      size: 4,
      blending: THREE.AdditiveBlending,
      transparent: true,
      sizeAttenuation: false
  } );
    




  function resizeRendererToDisplaySize(renderer) {
    const canvas = renderer.domElement;
    const width = canvas.clientWidth;
    const height = canvas.clientHeight;
    const needResize = canvas.width !== width || canvas.height !== height;
    if (needResize) {
      renderer.setSize(width, height, false);
    }
    return needResize;
  }

  function render() {

    if (resizeRendererToDisplaySize(renderer)) {
      const canvas = renderer.domElement;
      camera.aspect = canvas.clientWidth / canvas.clientHeight;
      camera.updateProjectionMatrix();
    }

    renderer.render(scene, camera);

    requestAnimationFrame(render);
  }

  requestAnimationFrame(render);
}

const beginBtn = document.querySelector('#startButton');
const overlay = document.querySelector('#overlay');


beginBtn.addEventListener('click', () => {
  overlay.style.display = 'none';
  main();
})

    </script>

</body>
</html>